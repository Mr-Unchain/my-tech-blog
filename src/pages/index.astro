---
// src/pages/index.astro
import ArticleCard from "../components/ArticleCard.astro";
import HeroSlideshow from "../components/HeroSlideshow.astro"; // スライドショーをインポート
import Sidebar from "../components/Sidebar.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import { getBlogs } from "../lib/microcms";

// ★★★ 記事の取得ロジックを修正しました ★★★
// 記事一覧とヒーローセクション用のデータを取得（例として最新5件）
const { contents: listPosts } = await getBlogs({ limit: 5 });

// その中から最新3件をヒーローセクション用にする
const heroPosts = listPosts.slice(0, 3);
// listPostsはそのまま記事一覧に使うことで、重複を許容します。

const getCategoryColor = (categoryName: string) => {
  switch (categoryName) {
    case "ガジェット":
      return "sky";
    case "個人開発":
      return "purple";
    case "IT":
      return "pink";
    default:
      return "slate";
  }
};
---

<BaseLayout>
  <main class="container mx-auto px-4 py-8 md:py-12">
    {/* ★★★ ヒーローセクションをスライドショーに置き換え ★★★ */}
    {heroPosts.length > 0 && <HeroSlideshow posts={heroPosts} />}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 lg:gap-16">
      <div class="lg:col-span-2">
        <h2
          class="text-2xl md:text-3xl font-bold mb-8 text-slate-100 border-b-2 border-blue-500 pb-3"
        >
          新しい記事
        </h2>
        <div class="space-y-8">
          {
            listPosts.map((post) => (
              <ArticleCard
                id={post.id}
                category={post.category}
                title={post.title}
                description={post.description}
                date={
                  post.publishedAt
                    ? new Date(post.publishedAt).toLocaleDateString("ja-JP")
                    : ""
                }
                imageUrl={post.eyecatch.url + "?w=400"}
                categoryColor={post.category.map(getCategoryColor)}
              />
            ))
          }
        </div>
        {/* ページネーション */}
        <div class="mt-12 flex justify-center">
          <nav class="flex items-center space-x-2">
            <a
              href="#"
              class="flex items-center justify-center h-10 w-10 bg-slate-800 border border-slate-700 text-slate-400 rounded-full hover:bg-slate-700 hover:text-white transition-colors"
              aria-label="前のページへ"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </a>
            <span
              aria-current="page"
              class="flex items-center justify-center h-10 w-10 bg-blue-600 border border-blue-500 text-white font-bold rounded-full z-10"
            >
              1
            </span>
            <a
              href="#"
              class="flex items-center justify-center h-10 w-10 bg-slate-800 border border-slate-700 text-slate-300 rounded-full hover:bg-slate-700 hover:text-white transition-colors"
            >
              2
            </a>
            <a
              href="#"
              class="flex items-center justify-center h-10 w-10 bg-slate-800 border border-slate-700 text-slate-300 rounded-full hover:bg-slate-700 hover:text-white transition-colors"
            >
              3
            </a>
            <a
              href="#"
              class="flex items-center justify-center h-10 w-10 bg-slate-800 border border-slate-700 text-slate-400 rounded-full hover:bg-slate-700 hover:text-white transition-colors"
              aria-label="次のページへ"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </a>
          </nav>
        </div>
      </div>
      <Sidebar />
    </div>
  </main>
</BaseLayout>

---
// src/components/Sidebar.astro
import { getBlogs } from "../lib/microcms";
// カテゴリー情報だけを取得して効率化
const { contents: posts } = await getBlogs({ fields: "id,category" });
const allCategories = posts.flatMap((post) => post.category);
const uniqueCategories = [...new Set(allCategories)];
---

<aside class="space-y-8">
  {/* プロフィール */}
  <div class="bg-white p-6 rounded-xl shadow-md text-center">
    <img
      class="w-24 h-24 rounded-full mx-auto mb-4"
      src="https://placehold.co/100x100/e2e8f0/334155?text=Me"
      alt="筆者のアバター"
    />
    <h3 class="font-bold text-lg text-slate-900">Taro Yamada</h3>
    <p class="text-sm text-slate-600 mt-2">
      ガジェットとテクノロジーを愛する都内在住のエンジニア。新しいモノに触れて、その感動を共有するのが好きです。
    </p>
    <div class="flex justify-center space-x-4 mt-4">
      <a href="#" class="text-slate-500 hover:text-blue-600">X</a>
      <a href="#" class="text-slate-500 hover:text-blue-600">GitHub</a>
      <a href="#" class="text-slate-500 hover:text-blue-600">Website</a>
    </div>
  </div>

  {/* ★★★検索フォーム★★★ */}
  <div class="bg-white p-6 rounded-xl shadow-md">
    <h3 class="font-bold text-lg mb-4 text-slate-900">検索</h3>
    <form class="flex" action="/search" method="GET">
      <input
        type="text"
        name="q"
        placeholder="キーワード..."
        class="w-full border-slate-300 rounded-l-lg focus:ring-blue-500 focus:border-blue-500"
      />
      <button
        type="submit"
        class="bg-slate-800 text-white px-4 rounded-r-lg hover:bg-slate-600"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          ><path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg
        >
      </button>
    </form>
  </div>

  {/* 人気記事 */}
  <div class="bg-white p-6 rounded-xl shadow-md">
    <h3 class="font-bold text-lg mb-4 text-slate-900">人気記事</h3>
    <ul class="space-y-4">
      <li>
        <a href="#" class="text-slate-700 hover:text-blue-600 hover:underline"
          >1. 次世代スマホ「Model-Z」徹底レビュー</a
        >
      </li>
      <li>
        <a href="#" class="text-slate-700 hover:text-blue-600 hover:underline"
          >2. 2024年版QOL爆上がりデスク周りアイテム</a
        >
      </li>
      <li>
        <a href="#" class="text-slate-700 hover:text-blue-600 hover:underline"
          >3. Notionをただのメモ帳で終わらせない</a
        >
      </li>
      <li>
        <a href="#" class="text-slate-700 hover:text-blue-600 hover:underline"
          >4. メカニカルキーボード沼へようこそ</a
        >
      </li>
    </ul>
  </div>

  <!-- カテゴリーリストを動的に生成 -->
  <div class="bg-white p-6 rounded-xl shadow-md">
    <h3 class="font-bold text-lg mb-4 text-slate-900">カテゴリ</h3>
    <ul class="space-y-2">
      {
        uniqueCategories.map((category) => (
          <li>
            <a
              href={`/category/${category}/`}
              class="text-slate-700 hover:text-blue-600 hover:underline"
            >
              {category}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</aside>
